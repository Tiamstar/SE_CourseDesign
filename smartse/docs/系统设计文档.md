# 基于大语言模型的软件工程课程助手 - 系统设计文档

## 1. 系统架构

### 1.1 总体架构

本系统采用前后端分离的架构：
- 前端：基于React.js的单页应用
- 后端：Node.js + Express构建的RESTful API服务
- 数据库：MongoDB存储用户会话数据
- 检索系统：Elasticsearch用于知识库检索
- AI服务：通过华为云大模型API提供智能能力

系统架构图：

```
+----------------+      +----------------+      +----------------+
|                |      |                |      |                |
|  Web前端       +----->+  后端服务器     +----->+  华为云大模型API |
|  (React.js)    |      |  (Node.js)     |      |                |
|                |      |                |      |                |
+----------------+      +-------+--------+      +----------------+
                                |
                                v
                        +-------+--------+      +----------------+
                        |                |      |                |
                        |  MongoDB       |      |  Elasticsearch |
                        |  (会话存储)     |      |  (知识库检索)   |
                        |                |      |                |
                        +----------------+      +----------------+
```

### 1.2 技术栈

- 前端：
  - React.js: 前端框架
  - Ant Design: UI组件库
  - React Router: 客户端路由
  - Axios: HTTP请求

- 后端：
  - Node.js: 运行环境
  - Express: Web框架
  - Mongoose: MongoDB数据库ODM
  - Elasticsearch.js: ES客户端
  - Winston: 日志管理

- 数据存储：
  - MongoDB: 存储聊天记录和用户会话
  - Elasticsearch: 存储和检索知识库内容

- 部署环境：
  - 华为云：云服务器和AI服务

## 2. 系统模块

### 2.1 前端模块

1. **核心组件**
   - App: 应用入口
   - Header: 顶部导航
   - Sidebar: 侧边导航菜单

2. **页面组件**
   - Home: 首页
   - ChatPage: 智能对话页面
   - ConceptExplainerPage: 概念解释页面
   - RequirementsAnalysisPage: 需求分析页面
   - DesignPage: 软件设计页面
   - TestingPage: 软件测试页面

3. **工具组件**
   - ChatInterface: 通用聊天界面组件
   - AgentSelector: 智能体选择器
   - MessageList: 消息列表展示

### 2.2 后端模块

1. **API层**
   - 路由定义和请求处理

2. **控制器层**
   - chat.controller.js: 处理聊天相关请求
   - concept.controller.js: 概念解释相关请求
   - requirements.controller.js: 需求分析相关请求
   - design.controller.js: 软件设计相关请求
   - testing.controller.js: 软件测试相关请求

3. **服务层**
   - llm.service.js: 大语言模型服务
   - elasticsearch.service.js: ES检索服务

4. **数据层**
   - chat.model.js: 聊天数据模型

## 3. 数据设计

### 3.1 MongoDB数据模型

1. **Chat Model**

```javascript
{
  sessionId: String,  // 会话ID
  agent: String,      // 智能体类型
  messages: [         // 消息列表
    {
      content: String,  // 消息内容
      sender: String,   // 发送者(user/assistant)
      timestamp: Date   // 时间戳
    }
  ],
  timestamp: Date     // 会话时间戳
}
```

### 3.2 Elasticsearch索引

1. **知识库索引**

```javascript
{
  title: String,       // 知识标题
  content: String,     // 知识内容
  category: String,    // 分类(concept/requirements/design/testing)
  tags: [String],      // 标签列表
  source: String,      // 来源
  created_at: Date     // 创建时间
}
```

## 4. 核心功能流程

### 4.1 智能聊天流程

1. 用户在前端选择智能体类型
2. 用户输入问题并发送
3. 前端将请求发送到后端API
4. 后端根据问题内容调用知识库检索服务
5. 根据检索结果和智能体类型构建提示词
6. 调用华为云大模型API获取回答
7. 后端将回答返回给前端
8. 前端展示回答并保存对话历史

### 4.2 知识检索增强流程

1. 接收用户输入的问题
2. 对问题进行预处理（分词、去停用词等）
3. 调用Elasticsearch进行相关知识检索
4. 根据相关度排序检索结果
5. 将检索结果作为上下文内容加入提示词
6. 构建完整的提示词发送给大语言模型
7. 大语言模型基于检索结果和自身知识生成回答

## 5. 安全与部署

### 5.1 安全措施

1. 使用环境变量存储敏感信息
2. API调用使用HTTPS
3. 实现基本的请求验证和限流
4. 日志记录请求和错误信息

### 5.2 部署方案

本系统将部署在华为云上，部署架构如下：

1. 前端：部署到华为云对象存储服务
2. 后端：部署到华为云ECS或云容器引擎
3. 数据库：使用华为云MongoDB服务
4. Elasticsearch：使用华为云ES服务
5. 大模型API：使用华为云大模型服务

## 6. 扩展性设计

系统设计考虑了以下扩展性：

1. **智能体扩展**: 系统设计允许添加新的专业智能体
2. **知识库扩展**: 知识库可以持续更新和扩充
3. **功能扩展**: 前后端的模块化设计使添加新功能变得简单
4. **替换AI模型**: 服务层设计使更换底层AI模型变得容易 