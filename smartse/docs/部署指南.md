# 基于大语言模型的软件工程课程助手 - 部署指南

本文档提供了如何在华为云上部署本软件工程课程助手系统的详细说明。

## 1. 准备工作

### 1.1 必要条件

在开始部署前，请确保你已经：

- 注册了华为云账号
- 获取了华为云大模型API访问权限和密钥
- 安装了以下工具：
  - Node.js (v14.x 或更高版本)
  - npm 或 yarn
  - Git
  - Docker (可选，用于容器化部署)

### 1.2 项目获取

从Git仓库克隆项目：

```bash
git clone https://github.com/your-org/smartse.git
cd smartse
```

## 2. 本地开发环境配置

### 2.1 前端配置

```bash
# 进入前端目录
cd client

# 安装依赖
npm install

# 复制环境配置
cp .env.example .env

# 修改.env文件中的API基础URL
# 例如：REACT_APP_API_BASE_URL=http://localhost:5000/api
```

### 2.2 后端配置

```bash
# 进入后端目录
cd server

# 安装依赖
npm install

# 复制环境配置
cp .env.example .env
```

编辑`.env`文件，设置必要的环境变量：

```
# 服务器配置
PORT=5000

# MongoDB配置
MONGO_URI=mongodb://localhost:27017/smartse

# Elasticsearch配置
ES_HOST=localhost:9200
ES_INDEX=smartse_knowledge

# 华为云大模型API配置
HW_LLM_API_URL=https://your-huawei-llm-api-url
HW_LLM_API_KEY=your-api-key-here
```

### 2.3 本地运行

**运行前端**:
```bash
cd client
npm start
```

**运行后端**:
```bash
cd server
npm run dev
```

## 3. 华为云部署

### 3.1 数据库服务配置

#### MongoDB配置

1. 在华为云控制台创建MongoDB服务
2. 创建数据库用户和密码
3. 获取连接字符串
4. 配置网络安全组允许访问

#### Elasticsearch配置

1. 在华为云控制台创建Elasticsearch服务
2. 设置集群配置和节点规格
3. 获取连接信息
4. 配置网络安全组允许访问

### 3.2 后端部署

#### 使用ECS部署

1. 在华为云创建ECS实例
   - 选择操作系统（推荐Ubuntu 20.04）
   - 配置网络和安全组
   - 分配公网IP

2. SSH连接到ECS实例

3. 安装必要的软件：
   ```bash
   sudo apt update
   sudo apt install -y nodejs npm git nginx
   ```

4. 克隆仓库并配置：
   ```bash
   git clone https://github.com/your-org/smartse.git
   cd smartse/server
   npm install
   ```

5. 创建环境配置文件：
   ```bash
   cp .env.example .env
   vim .env  # 编辑配置文件
   ```

6. 使用PM2管理Node.js应用：
   ```bash
   npm install -g pm2
   pm2 start index.js --name smartse-server
   pm2 startup
   pm2 save
   ```

7. 配置Nginx反向代理：
   ```bash
   sudo vim /etc/nginx/sites-available/smartse-server
   ```

   添加以下配置：
   ```
   server {
     listen 80;
     server_name your-domain.com;

     location /api {
       proxy_pass http://localhost:5000;
       proxy_http_version 1.1;
       proxy_set_header Upgrade $http_upgrade;
       proxy_set_header Connection 'upgrade';
       proxy_set_header Host $host;
       proxy_cache_bypass $http_upgrade;
     }
   }
   ```

8. 启用站点并重启Nginx：
   ```bash
   sudo ln -s /etc/nginx/sites-available/smartse-server /etc/nginx/sites-enabled/
   sudo nginx -t
   sudo systemctl restart nginx
   ```

#### 使用容器部署（可选）

1. 创建Dockerfile：
   ```bash
   cd server
   vim Dockerfile
   ```

   添加以下内容：
   ```dockerfile
   FROM node:14

   WORKDIR /usr/src/app

   COPY package*.json ./
   RUN npm install

   COPY . .

   EXPOSE 5000

   CMD ["node", "index.js"]
   ```

2. 构建并推送Docker镜像：
   ```bash
   docker build -t smartse-server .
   docker tag smartse-server swr.cn-north-4.myhuaweicloud.com/your-org/smartse-server
   docker push swr.cn-north-4.myhuaweicloud.com/your-org/smartse-server
   ```

3. 在华为云容器服务中创建部署

### 3.3 前端部署

1. 构建前端生产文件：
   ```bash
   cd client
   npm run build
   ```

2. 使用华为云对象存储服务(OBS)部署前端：
   - 在华为云控制台创建OBS桶
   - 上传`build`目录下的所有文件
   - 配置桶为静态网站托管模式
   - 配置自定义域名（可选）

3. 配置CDN加速（可选）：
   - 在华为云控制台创建CDN
   - 设置OBS桶为源站
   - 配置CDN加速域名

## 4. 系统监控和维护

### 4.1 日志管理

- 使用华为云日志服务收集系统日志
- 配置日志告警规则

### 4.2 性能监控

- 使用华为云APM服务监控应用性能
- 设置关键指标的告警阈值

### 4.3 数据备份

- 配置MongoDB定期备份
- 设置数据备份策略和恢复流程

## 5. 安全配置

### 5.1 HTTPS配置

1. 获取SSL证书
2. 配置Nginx使用HTTPS：
   ```
   server {
     listen 443 ssl;
     server_name your-domain.com;

     ssl_certificate /path/to/cert.pem;
     ssl_certificate_key /path/to/key.pem;

     # SSL配置...

     location /api {
       proxy_pass http://localhost:5000;
       # 其他代理配置...
     }
   }
   ```

### 5.2 安全最佳实践

- 定期更新系统和依赖包
- 实施IP限制和访问控制
- 配置API请求限流
- 使用环境变量存储敏感信息

## 6. 故障排除

### 6.1 常见问题

1. **连接数据库失败**
   - 检查MongoDB连接字符串
   - 验证网络安全组设置
   - 确认数据库服务状态

2. **Elasticsearch连接问题**
   - 检查ES连接配置
   - 验证ES集群健康状态
   - 检查索引是否正确创建

3. **大模型API调用失败**
   - 验证API密钥是否正确
   - 检查API请求格式
   - 查看调用限制和配额

### 6.2 获取支持

如遇到无法解决的问题，请通过以下渠道获取支持：

- 提交GitHub Issue
- 联系系统管理员
- 参考华为云官方文档 